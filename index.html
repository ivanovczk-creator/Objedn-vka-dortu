<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poptávka dortu - Cukrářství Blahutovi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              serif: ['"Playfair Display"', 'serif'],
              sans: ['"Lato"', 'sans-serif'],
            },
            colors: {
              brand: {
                50: '#fdf2f8', 100: '#fce7f3', 200: '#fbcfe8', 300: '#f9a8d4',
                400: '#f472b6', 500: '#ec4899', 600: '#db2777', 800: '#9d174d', 900: '#831843',
              }
            }
          }
        }
      }
    </script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- React & Babel (UMD Global Build - No Build Step Required) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google GenAI SDK via Import Map -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@0.1.1",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>

    <style>
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #fdf2f8; }
      ::-webkit-scrollbar-thumb { background: #f9a8d4; border-radius: 4px; }
      .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-brand-50 text-gray-800 antialiased">
    
    <div id="root">
        <!-- Loading UI displayed before React loads -->
        <div style="height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #db2777;">
            <svg class="animate-spin h-10 w-10 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="font-sans text-xl font-bold">Načítám aplikaci...</p>
        </div>
    </div>

    <script type="text/babel" data-type="module">
        import { GoogleGenAI } from '@google/genai';
        
        // --- API KEY ---
        const API_KEY = "AIzaSyBBLCD7k1lgljXCR6nPrylGnsoOdT1qqqI";

        // --- ICONS (Inlined for performance) ---
        const Icon = ({ p, children }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}>{children}</svg>;
        const Camera = (p) => <Icon p={p}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>;
        const MapPin = (p) => <Icon p={p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
        const CalendarIcon = (p) => <Icon p={p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>;
        const Loader2 = (p) => <Icon p={p}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></Icon>;
        const CheckCircle2 = (p) => <Icon p={p}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></Icon>;
        const ChevronLeft = (p) => <Icon p={p}><path d="m15 18-6-6 6-6"/></Icon>;
        const ChevronRight = (p) => <Icon p={p}><path d="m9 18 6-6-6-6"/></Icon>;
        const Upload = (p) => <Icon p={p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>;
        const X = (p) => <Icon p={p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const Plus = (p) => <Icon p={p}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Mail = (p) => <Icon p={p}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></Icon>;
        const Phone = (p) => <Icon p={p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></Icon>;
        const User = (p) => <Icon p={p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Printer = (p) => <Icon p={p}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></Icon>;

        // --- CONSTANTS ---
        const { useState, useEffect, useMemo } = React;
        const CakeShape = { ROUND: 'Kulatý', RECTANGLE: 'Obdélník', SQUARE: 'Čtverec', HEART: 'Srdíčko' };
        const FillingType = { RASPBERRY: 'Malinová', CHOCOLATE: 'Čokoládová', CHERRY: 'Višňová', BLUEBERRY: 'Borůvková', PISTACHIO: 'Pistáciová', WALNUT: 'Ořechová', APRICOT: 'Meruňková', MANGO_PASSION: 'Mango-maracuja', VANILLA: 'Vanilková' };
        const SpongeType = { CHOCOLATE: 'Čokoládový', VANILLA: 'Vanilkový', WALNUT: 'Ořechový', MOSS: 'Mechový', RED_VELVET: 'Red-Velvet' };
        const SurfaceType = { CREAM: 'Krémový', CREAM_DRIP: 'Krémový a stékaná čokoláda', MARZIPAN: 'Marcipánový', CHOCO_SHAVINGS: 'Čoko-hobliny', EDIBLE_PRINT: 'Jedlý tisk', OTHER: 'Jiné' };

        const LOCATIONS = [
          { id: 'petrvald', name: 'Petřvald', address: 'Šenovská 1', phone: '778 157 857', type: 'store' },
          { id: 'karvina', name: 'Karviná', address: 'Tř. Těreškovové 2233/28', phone: '778 157 867', type: 'store' },
          { id: 'ostrava', name: 'Ostrava Zábřeh', address: 'Výškovická 116A', phone: '775 271 101', type: 'store' },
          { id: 'pist', name: 'Píšť (Výrobna)', address: 'Opavská 218/101', phone: '602 323 788', type: 'factory' }
        ];

        const CZECH_HOLIDAYS = ["01-01", "01-05", "08-05", "05-07", "06-07", "28-09", "28-10", "17-11", "24-12", "25-12", "26-12"];
        const CAKE_COLORS = [
          { name: 'Bílá', hex: '#FFFFFF' }, { name: 'Šedá', hex: '#9CA3AF' }, { name: 'Černá', hex: '#000000' },
          { name: 'Růžová', hex: '#F472B6' }, { name: 'Červená', hex: '#EF4444' }, { name: 'Hnědá', hex: '#854d0e' },
          { name: 'Oranžová', hex: '#F97316' }, { name: 'Modrá', hex: '#3B82F6' }, { name: 'Fialová', hex: '#A855F7' },
          { name: 'Zelená', hex: '#22C55E' }, { name: 'Žlutá', hex: '#EAB308' },
        ];
        const SHAVINGS_OPTIONS = ["Bílá", "Hnědá", "Růžová"];
        const DRIP_OPTIONS = ["Tmavá čokoláda", "Bílá čokoláda"];
        const ROUND_SIZES = ["26", "24", "22", "18", "16", "14"]; 
        const SQUARE_SIZES = ["28", "24", "20", "16"];
        const RECTANGLE_SIZES = ["60x40", "40x30", "Jiné"];
        const HEART_SIZES = ["24", "18", "16"];

        // --- SERVICES ---
        const fileToGenerativePart = async (file) => {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        };

        const analyzeCakeImage = async (file) => {
          try {
            if (!API_KEY || API_KEY.includes("ZDE_VLOZTE")) { console.warn("API Key missing"); return {}; }
            const ai = new GoogleGenAI({ apiKey: API_KEY });
            const base64Data = await fileToGenerativePart(file);
            const prompt = "Analyze this cake image for a custom order form. 1. Identify shape (Round, Rectangle, Square, Heart). 2. Identify dominant color hex. 3. Write a short poetic description in Czech. Return JSON.";
            
            const response = await ai.models.generateContent({
              model: "gemini-2.5-flash",
              contents: { parts: [{ inlineData: { mimeType: file.type, data: base64Data } }, { text: prompt }] },
              config: { responseMimeType: "application/json" }
            });
            
            const data = JSON.parse(response.text());
            let mapShape = undefined;
            if (data.shape === "Round") mapShape = CakeShape.ROUND;
            if (data.shape === "Rectangle") mapShape = CakeShape.RECTANGLE;
            if (data.shape === "Square") mapShape = CakeShape.SQUARE;
            if (data.shape === "Heart") mapShape = CakeShape.HEART;
            
            return { suggestedShape: mapShape, suggestedColor: data.hexColor, description: data.description };
          } catch (e) { console.error(e); return {}; }
        };

        // --- COMPONENTS ---
        const Steps = ({ currentStep, totalSteps }) => (
          <div className="w-full py-6">
            <div className="flex items-center justify-center space-x-2">
              {Array.from({ length: totalSteps }).map((_, idx) => {
                const stepNum = idx + 1;
                const isActive = stepNum === currentStep;
                const isCompleted = stepNum < currentStep;
                return (
                  <React.Fragment key={stepNum}>
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-all duration-300 ${isActive ? 'bg-brand-600 text-white scale-110 shadow-lg' : isCompleted ? 'bg-brand-300 text-brand-900' : 'bg-gray-200 text-gray-400'}`}>
                      {isCompleted ? '✓' : stepNum}
                    </div>
                    {stepNum < totalSteps && <div className={`h-1 w-8 sm:w-16 rounded transition-all duration-300 ${isCompleted ? 'bg-brand-300' : 'bg-gray-200'}`} />}
                  </React.Fragment>
                );
              })}
            </div>
            <div className="text-center mt-2 text-brand-800 font-serif font-medium">
              {currentStep === 1 && "Předloha a Základ"} {currentStep === 2 && "Příchuť a Vzhled"}
              {currentStep === 3 && "Detaily"} {currentStep === 4 && "Vyzvednutí"} {currentStep === 5 && "Souhrn"}
            </div>
          </div>
        );

        const Calendar = ({ selectedDate, onSelect }) => {
          const [viewDate, setViewDate] = useState(new Date());
          const minDate = useMemo(() => { const d = new Date(); d.setDate(d.getDate() + 7); d.setHours(0,0,0,0); return d; }, []);
          const getDaysInMonth = (y, m) => new Date(y, m + 1, 0).getDate();
          const isHoliday = (d) => CZECH_HOLIDAYS.includes(`${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}`);
          const isDisabled = (d) => d < minDate || isHoliday(d);
          
          const renderDays = () => {
            const y = viewDate.getFullYear(), m = viewDate.getMonth();
            const days = [], firstDay = new Date(y, m, 1).getDay();
            for(let i=0; i<firstDay; i++) days.push(<div key={`e-${i}`} />);
            for(let d=1; d<=getDaysInMonth(y, m); d++) {
              const curr = new Date(y, m, d);
              const disabled = isDisabled(curr);
              const sel = selectedDate && selectedDate.toDateString() === curr.toDateString();
              days.push(
                <button key={d} disabled={disabled} onClick={() => onSelect(curr)} className={`p-2 rounded-lg text-sm font-medium ${sel ? 'bg-brand-600 text-white' : disabled ? 'text-gray-300 cursor-not-allowed' : 'hover:bg-brand-100'}`}>
                  {d}
                </button>
              );
            }
            return days;
          };

          return (
            <div className="bg-white p-4 rounded-xl shadow border border-brand-100 max-w-sm mx-auto">
              <div className="flex justify-between mb-4 font-bold text-brand-900">
                <button onClick={() => setViewDate(new Date(viewDate.setMonth(viewDate.getMonth()-1)))}>&lt;</button>
                <span>{viewDate.toLocaleString('cs-CZ', { month: 'long', year: 'numeric' })}</span>
                <button onClick={() => setViewDate(new Date(viewDate.setMonth(viewDate.getMonth()+1)))}>&gt;</button>
              </div>
              <div className="grid grid-cols-7 gap-1 text-center font-bold text-xs text-gray-500 mb-2">{["Ne","Po","Út","St","Čt","Pá","So"].map(d=><div key={d}>{d}</div>)}</div>
              <div className="grid grid-cols-7 gap-1">{renderDays()}</div>
              <div className="mt-2 text-xs text-gray-500 text-center">* Min. 7 dní na přípravu</div>
            </div>
          );
        };

        // --- APP ---
        function App() {
          const [step, setStep] = useState(1);
          const [order, setOrder] = useState({
            tiers: 1, tierSizes: ["24"], shape: CakeShape.ROUND, filling: FillingType.RASPBERRY, sponge: SpongeType.VANILLA,
            surface: SurfaceType.CREAM, inscription: '', specifications: '', quantity: 1, pickupDate: null, pickupLocationId: 'petrvald',
            images: [], customerName: '', customerEmail: '', customerPhone: ''
          });
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [aiResult, setAiResult] = useState(null);

          const updateOrder = (upd) => setOrder(prev => ({ ...prev, ...upd }));
          
          const handleFileChange = async (e) => {
            if (!e.target.files?.length) return;
            const newFiles = Array.from(e.target.files).slice(0, 5 - order.images.length);
            const newImgs = newFiles.map(f => ({ id: Math.random().toString(36).substring(7), file: f, previewUrl: URL.createObjectURL(f) }));
            setOrder(prev => ({ ...prev, images: [...prev.images, ...newImgs] }));
            
            if (newImgs.length && !isAnalyzing) {
              setIsAnalyzing(true);
              const res = await analyzeCakeImage(newImgs[0].file);
              if (res.description) setAiResult(res.description);
              if (res.suggestedShape) handleShapeChange(res.suggestedShape);
              setIsAnalyzing(false);
            }
            e.target.value = '';
          };

          const handleEdiblePrintUpload = (e) => {
             if (e.target.files?.[0]) {
                const f = e.target.files[0];
                setOrder(p => ({ ...p, ediblePrintImage: { id: Math.random(), file: f, previewUrl: URL.createObjectURL(f) } }));
             }
          };

          const handleShapeChange = (shape) => {
             let sizes = shape === CakeShape.ROUND ? ROUND_SIZES : shape === CakeShape.SQUARE ? SQUARE_SIZES : shape === CakeShape.RECTANGLE ? RECTANGLE_SIZES : HEART_SIZES;
             setOrder(p => ({ ...p, shape, tierSizes: Array(p.tiers).fill(sizes[0]), customSizeNote: '' }));
          };

          const getSizes = (idx) => {
             let opts = order.shape === CakeShape.ROUND ? ROUND_SIZES : order.shape === CakeShape.SQUARE ? SQUARE_SIZES : order.shape === CakeShape.RECTANGLE ? RECTANGLE_SIZES : HEART_SIZES;
             if (idx === 0 || order.shape === CakeShape.RECTANGLE) return opts;
             const prev = parseInt(order.tierSizes[idx-1]);
             return opts.filter(s => parseInt(s) < prev);
          };

          const isStepValid = () => {
            if (step === 2) {
               if (!order.filling || !order.sponge || !order.surface) return false;
               if (order.surface === SurfaceType.MARZIPAN && !order.marzipanColor) return false;
               if (order.surface === SurfaceType.CREAM && !order.creamColor) return false;
               if (order.surface === SurfaceType.CREAM_DRIP && (!order.creamColor || !order.dripType)) return false;
               if (order.surface === SurfaceType.CHOCO_SHAVINGS && !order.shavingsType) return false;
               if (order.surface === SurfaceType.EDIBLE_PRINT && !order.ediblePrintImage) return false;
            }
            if (step === 4 && !order.pickupDate) return false;
            return true;
          };

          const submit = () => {
            let sd = order.surface;
            if (order.surface === SurfaceType.MARZIPAN) sd += ` (Barva: ${order.marzipanColor})`;
            if (order.surface === SurfaceType.CREAM) sd += ` (Barva: ${order.creamColor})`;
            if (order.surface === SurfaceType.CREAM_DRIP) sd += ` (Krém: ${order.creamColor}, Drip: ${order.dripType})`;
            if (order.surface === SurfaceType.CHOCO_SHAVINGS) sd += ` (Typ: ${order.shavingsType})`;
            if (order.surface === SurfaceType.EDIBLE_PRINT) sd += ` (TISK Z PŘÍLOHY)`;
            if (order.surface === SurfaceType.OTHER) sd += ` (Pozn: ${order.surfaceOtherNote})`;
            
            const body = `POPTÁVKA DORTU\nKlient: ${order.customerName}, Tel: ${order.customerPhone}, Email: ${order.customerEmail}\n\nVyzvednutí: ${order.pickupDate?.toLocaleDateString()} - ${LOCATIONS.find(l=>l.id===order.pickupLocationId)?.name}\n\nDORT:\nTvar: ${order.shape} (${order.tiers}p)\nRozměry: ${order.tierSizes.join('/')} ${order.customSizeNote||''}\nKorpus: ${order.sponge}, Náplň: ${order.filling}\nPovrch: ${sd}\nNápis: ${order.inscription}\nPozn: ${order.specifications}`;
            window.location.href = `mailto:cukrarna.pist@seznam.cz?subject=Poptávka dortu - ${order.customerName}&body=${encodeURIComponent(body)}`;
          };

          const renderNav = () => (
             <div className="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow-lg z-40">
                <div className="max-w-4xl mx-auto flex justify-between gap-4">
                  <button onClick={() => setStep(s => Math.max(1, s-1))} disabled={step===1} className="flex items-center px-4 py-3 rounded-xl font-bold text-gray-600 hover:bg-gray-100 disabled:opacity-50"><ChevronLeft className="mr-1 h-5 w-5"/> Zpět</button>
                  {step < 5 
                    ? <button onClick={() => isStepValid() && setStep(s => s+1)} disabled={!isStepValid()} className="flex-1 sm:flex-none flex justify-center items-center bg-brand-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-brand-700 disabled:opacity-50">Pokračovat <ChevronRight className="ml-1 h-5 w-5"/></button>
                    : <button onClick={submit} disabled={!order.customerName} className="flex-1 sm:flex-none flex justify-center items-center bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 disabled:opacity-50">Odeslat poptávku <Mail className="ml-2 h-5 w-5"/></button>
                  }
                </div>
             </div>
          );

          return (
            <div className="min-h-screen bg-gradient-to-br from-brand-50 to-white pb-24">
              <nav className="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-brand-100">
                <div className="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
                   <h1 className="font-serif text-xl sm:text-2xl font-bold text-brand-800 truncate">Poptávka dortu - Cukrářství Blahutovi</h1>
                </div>
              </nav>

              <main className="max-w-4xl mx-auto px-4 mt-6">
                <Steps currentStep={step} totalSteps={5} />
                <div className="mt-8">
                   {step === 1 && (
                     <div className="space-y-6 animate-fade-in">
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100">
                           <h2 className="text-2xl font-serif text-brand-900 mb-4 flex items-center"><Camera className="mr-2 text-brand-500"/> Předloha</h2>
                           <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                              {order.images.map(img => (
                                 <div key={img.id} className="relative aspect-square group"><img src={img.previewUrl} className="w-full h-full object-cover rounded-lg shadow-sm" /><button onClick={()=>setOrder(p=>({...p, images: p.images.filter(i=>i.id!==img.id)}))} className="absolute top-1 right-1 bg-white rounded-full p-1 text-gray-500 shadow hover:text-red-500"><X size={14}/></button></div>
                              ))}
                              {order.images.length < 5 && <label className="aspect-square border-2 border-dashed border-brand-200 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:bg-brand-50 text-brand-400 hover:text-brand-600 transition-colors"><Plus size={32}/><span className="text-xs font-bold mt-2">Nahrát</span><input type="file" hidden multiple onChange={handleFileChange}/></label>}
                           </div>
                           {isAnalyzing && <div className="mt-4 flex items-center justify-center text-brand-600 bg-brand-50 p-3 rounded-lg"><Loader2 className="animate-spin mr-2 h-5 w-5"/> AI Analyzuje...</div>}
                           {aiResult && <div className="mt-4 bg-white p-4 rounded-lg border border-brand-100 text-center italic text-brand-800">"{aiResult}"</div>}
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100">
                           <h2 className="text-2xl font-serif text-brand-900 mb-6">Tvar a Velikost</h2>
                           <div className="flex flex-wrap gap-2 mb-6">{Object.values(CakeShape).map(s => <button key={s} onClick={()=>handleShapeChange(s)} className={`px-4 py-3 rounded-xl border text-sm font-bold transition-all ${order.shape===s?'bg-brand-600 text-white shadow-md transform scale-105':'bg-white text-gray-600 border-gray-200 hover:border-brand-300'}`}>{s}</button>)}</div>
                           <div className="mb-6">
                              <label className="block text-sm font-bold text-gray-700 mb-2">Počet pater</label>
                              <div className="flex gap-2">{[1,2,3].map(n => <button key={n} onClick={()=>{const sz=Array(n).fill(getSizes(0)[0]); setOrder(p=>({...p, tiers:n, tierSizes:sz}))}} className={`flex-1 py-3 rounded-lg border-2 font-bold transition-all ${order.tiers===n?'border-brand-500 bg-brand-50 text-brand-700':'border-gray-200 text-gray-500'}`}>{n}</button>)}</div>
                           </div>
                           <div className="space-y-3">
                              {order.tierSizes.map((sz, i) => (
                                 <div key={i} className="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                    <div className="text-sm font-bold text-gray-800 mb-1">{i+1}. patro</div>
                                    <select value={sz} onChange={(e)=>{const n=[...order.tierSizes]; n[i]=e.target.value; setOrder(p=>({...p, tierSizes:n}))}} className="w-full p-2.5 bg-white border border-gray-300 rounded-lg">{getSizes(i).map(s=><option key={s} value={s}>{s} cm</option>)}</select>
                                    {order.shape===CakeShape.RECTANGLE && sz==='Jiné' && <input placeholder="Např. 50x30" value={order.customSizeNote||''} onChange={e=>updateOrder({customSizeNote:e.target.value})} className="mt-2 w-full p-2 border border-gray-300 rounded"/>}
                                 </div>
                              ))}
                           </div>
                        </div>
                     </div>
                   )}
                   {step === 2 && (
                     <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100 space-y-6 animate-fade-in">
                        <h2 className="text-2xl font-serif text-brand-900">Příchuť a Vzhled</h2>
                        <div className="grid md:grid-cols-2 gap-6">
                           <label className="block text-sm font-bold text-gray-700">Náplň<select value={order.filling} onChange={e=>updateOrder({filling:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg mt-1 bg-gray-50">{Object.values(FillingType).map(v=><option key={v} value={v}>{v}</option>)}</select></label>
                           <label className="block text-sm font-bold text-gray-700">Korpus<select value={order.sponge} onChange={e=>updateOrder({sponge:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg mt-1 bg-gray-50">{Object.values(SpongeType).map(v=><option key={v} value={v}>{v}</option>)}</select></label>
                        </div>
                        <div>
                           <label className="block text-sm font-bold text-gray-700 mb-3">Povrch</label>
                           <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">{Object.values(SurfaceType).map(s=><label key={s} className={`p-3 border rounded-lg cursor-pointer flex items-center transition-colors ${order.surface===s?'bg-brand-50 border-brand-500 ring-1 ring-brand-500':'border-gray-200 hover:bg-gray-50'}`}><input type="radio" checked={order.surface===s} onChange={()=>updateOrder({surface:s})} className="text-brand-600 focus:ring-brand-500 mr-2"/><span className="text-sm">{s}</span></label>)}</div>
                        </div>
                        {(order.surface === SurfaceType.MARZIPAN || order.surface === SurfaceType.CREAM || order.surface === SurfaceType.CREAM_DRIP) && (
                           <div className="bg-brand-50 p-4 rounded-lg border border-brand-100">
                              <span className="text-sm font-bold text-gray-700 block mb-2">Barva {order.surface===SurfaceType.MARZIPAN?'marcipánu':'krému'}:</span>
                              <div className="flex flex-wrap gap-2">{CAKE_COLORS.map(c=><button key={c.name} onClick={()=>updateOrder(order.surface===SurfaceType.MARZIPAN?{marzipanColor:c.name}:{creamColor:c.name})} className={`w-10 h-10 rounded-full border-2 shadow-sm transition-transform hover:scale-105 ${order[order.surface===SurfaceType.MARZIPAN?'marzipanColor':'creamColor']===c.name?'border-gray-800 scale-110 ring-2 ring-white':'border-gray-200'}`} style={{backgroundColor:c.hex}} title={c.name}>{order[order.surface===SurfaceType.MARZIPAN?'marzipanColor':'creamColor']===c.name && <span className={`text-xs font-bold ${['Bílá','Žlutá'].includes(c.name)?'text-black':'text-white'}`}>✓</span>}</button>)}</div>
                           </div>
                        )}
                        {order.surface === SurfaceType.CREAM_DRIP && (
                           <div className="bg-brand-50 p-4 rounded-lg border border-brand-100 mt-2"><span className="text-sm font-bold text-gray-700 block mb-2">Druh stékání:</span><div className="flex gap-4">{DRIP_OPTIONS.map(o=><label key={o} className="flex items-center cursor-pointer"><input type="radio" checked={order.dripType===o} onChange={()=>updateOrder({dripType:o})} className="text-brand-600 focus:ring-brand-500 mr-2"/><span className="text-sm text-gray-700">{o}</span></label>)}</div></div>
                        )}
                        {order.surface === SurfaceType.CHOCO_SHAVINGS && (
                           <div className="bg-brand-50 p-4 rounded-lg border border-brand-100 mt-2"><span className="text-sm font-bold text-gray-700 block mb-2">Barva hoblin:</span><div className="flex gap-4">{SHAVINGS_OPTIONS.map(o=><label key={o} className="flex items-center cursor-pointer"><input type="radio" checked={order.shavingsType===o} onChange={()=>updateOrder({shavingsType:o})} className="text-brand-600 focus:ring-brand-500 mr-2"/><span className="text-sm text-gray-700">{o}</span></label>)}</div></div>
                        )}
                        {order.surface === SurfaceType.EDIBLE_PRINT && (
                           <div className="bg-brand-50 p-4 rounded-lg border border-brand-100 mt-2">
                              <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center"><Printer className="w-4 h-4 mr-2"/> Nahrát obrázek pro tisk *</label>
                              {!order.ediblePrintImage ? <label className="border-2 border-brand-200 border-dashed rounded-xl flex flex-col items-center justify-center p-6 cursor-pointer hover:bg-white bg-white transition-colors"><Upload className="h-8 w-8 text-brand-400 mb-2"/><span className="text-sm font-medium text-brand-600">Vybrat soubor</span><input type="file" hidden accept="image/*" onChange={handleEdiblePrintUpload} /></label> : <div className="relative aspect-video rounded-xl overflow-hidden shadow-sm border border-gray-200 bg-white"><img src={order.ediblePrintImage.previewUrl} className="w-full h-full object-contain" /><button onClick={(e)=>{e.preventDefault();setOrder(p=>({...p, ediblePrintImage:undefined}))}} className="absolute top-2 right-2 bg-white/90 rounded-full p-1.5 text-gray-500 hover:text-red-500"><X size={16}/></button></div>}
                           </div>
                        )}
                        {order.surface === SurfaceType.OTHER && <div className="mt-2"><label className="block text-sm font-bold text-gray-700 mb-2">Poznámka</label><input value={order.surfaceOtherNote||''} onChange={e=>updateOrder({surfaceOtherNote:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-brand-500 focus:border-brand-500" placeholder="Specifikujte..."/></div>}
                     </div>
                   )}
                   {step === 3 && (
                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100 space-y-6 animate-fade-in">
                         <h2 className="text-2xl font-serif text-brand-900">Detaily</h2>
                         <div><label className="block text-sm font-bold text-gray-700 mb-2">Nápis na dort</label><input value={order.inscription} onChange={e=>updateOrder({inscription:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-brand-500 focus:border-brand-500" placeholder="Tomášek 5 let"/></div>
                         <div><label className="block text-sm font-bold text-gray-700 mb-2">Další specifikace</label><textarea value={order.specifications} onChange={e=>updateOrder({specifications:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-brand-500 focus:border-brand-500" rows={3} placeholder="Alergie, zdobení..."/></div>
                         <div><label className="block text-sm font-bold text-gray-700 mb-2">Množství</label><div className="flex items-center gap-4"><button onClick={()=>updateOrder({quantity:Math.max(1,order.quantity-1)})} className="w-10 h-10 rounded-full bg-gray-100 font-bold hover:bg-gray-200">-</button><span className="text-xl font-bold text-brand-900">{order.quantity} ks</span><button onClick={()=>updateOrder({quantity:order.quantity+1})} className="w-10 h-10 rounded-full bg-gray-100 font-bold hover:bg-gray-200">+</button></div></div>
                      </div>
                   )}
                   {step === 4 && (
                      <div className="grid lg:grid-cols-2 gap-8 animate-fade-in">
                         <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100"><h2 className="text-xl font-serif font-bold text-brand-900 mb-4 flex items-center"><CalendarIcon className="mr-2 text-brand-500"/> Datum</h2><div className="flex justify-center"><Calendar selectedDate={order.pickupDate} onSelect={d=>updateOrder({pickupDate:d})} /></div></div>
                         <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100"><h2 className="text-xl font-serif font-bold text-brand-900 mb-4 flex items-center"><MapPin className="mr-2 text-brand-500"/> Místo</h2><div className="space-y-3">{LOCATIONS.map(l=><button key={l.id} onClick={()=>updateOrder({pickupLocationId:l.id})} className={`w-full text-left p-4 rounded-xl border transition-all ${order.pickupLocationId===l.id?'border-brand-500 bg-brand-50 ring-1 ring-brand-500':'bg-white hover:border-brand-300 border-gray-200'}`}><div className="font-bold text-gray-900">{l.name}</div><div className="text-sm text-gray-600">{l.address}</div></button>)}</div></div>
                      </div>
                   )}
                   {step === 5 && (
                      <div className="space-y-6 animate-fade-in">
                         <div className="bg-white p-6 rounded-2xl shadow-sm border border-brand-100">
                            <h2 className="text-xl font-serif font-bold text-brand-900 mb-4 flex items-center"><User className="mr-2 text-brand-500"/> Kontaktní údaje</h2>
                            <div className="space-y-4">
                               <input placeholder="Jméno a příjmení" value={order.customerName} onChange={e=>updateOrder({customerName:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-brand-500 focus:border-brand-500"/>
                               <div className="grid md:grid-cols-2 gap-4"><input placeholder="Telefon" value={order.customerPhone} onChange={e=>updateOrder({customerPhone:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-brand-500 focus:border-brand-500"/><input placeholder="Email" value={order.customerEmail} onChange={e=>updateOrder({customerEmail:e.target.value})} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-brand-500 focus:border-brand-500"/></div>
                            </div>
                         </div>
                         <div className="bg-white p-8 rounded-2xl shadow-lg border border-brand-200 relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-300 to-brand-600"/>
                            <h2 className="text-2xl font-serif text-center mb-6 text-gray-900">Souhrn Poptávky</h2>
                            <div className="space-y-3 text-sm divide-y divide-gray-100">
                               <div className="flex justify-between py-2"><span>Tvar:</span> <span className="font-bold">{order.shape} ({order.tiers}p)</span></div>
                               <div className="flex justify-between py-2"><span>Rozměry:</span> <span className="font-bold">{order.tierSizes.join('/')} cm</span></div>
                               <div className="flex justify-between py-2"><span>Složení:</span> <span>{order.filling}, {order.sponge}</span></div>
                               <div className="flex justify-between py-2"><span>Povrch:</span> <span className="font-bold">{order.surface} {order.surface === SurfaceType.MARZIPAN && order.marzipanColor && `(${order.marzipanColor})`}</span></div>
                               <div className="flex justify-between py-2 border-t pt-4"><span>Vyzvednutí:</span> <span className="font-bold text-brand-600">{order.pickupDate?.toLocaleDateString()}</span></div>
                            </div>
                         </div>
                      </div>
                   )}
                </div>
                {renderNav()}
              </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>